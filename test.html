
<video id="video" controls></video>
<input type="range" min="1" max="100" value="50" class="slider" id="progress">
<span id="progress-num"></span>
<script type="text/javascript">
  fetch('http://localhost:3000/clips/list/10926665-f335-4b39-80f6-c18211a1c567').then(response => {


    return response.text();
  }).then(text => {
    const clips = JSON.parse(text).reverse();
    const firstClip = clips[0];
    const lastClip = clips[clips.length - 1];

    let totalDuration = 0;
    let activeVideo = 0;

    clips.forEach(clip => {
      totalDuration += clip.duration;
    });

    const rangeElement = document.getElementById('progress');
    const videoElement = document.getElementById('video');

    const start = new Date(firstClip.start);
    const end = new Date(lastClip.end);
    console.log(clips);
    rangeElement.min = start.valueOf()
    rangeElement.max = end.valueOf();
    rangeElement.value = rangeElement.min;

    rangeElement.onchange = (() => {
      const date = new Date(0);

      date.setUTCMilliseconds(rangeElement.value);

      console.log(date);
      const clip = clips.find((clip, index) => {
        const clipInRange = new Date(clip.start) <= date && new Date(clip.end) >= date;

        if (clipInRange) {
          activeVideo = index;
        }

        return clipInRange;
      });


      if (!!clip) {
        videoElement.src = `http://localhost:3000/clips/${clip.id}.mp4`;
      }
    })


    videoElement.addEventListener('ended', () => {
      activeVideo++
      if (activeVideo >= clips.length) return;
      videoElement.pause();
      videoElement.src = `http://localhost:3000/clips/${clips[activeVideo].id}.mp4`;
    })

    videoElement.addEventListener('loadeddata', () => {
      if (activeVideo >= clips.length) return;
      videoElement.play();
    });

    videoElement.src = `http://localhost:3000/clips/${firstClip.id}.mp4`;
  })
</script>
